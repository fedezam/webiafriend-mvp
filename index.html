<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>WebIAFriend - MVP</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
    .success { color: green; font-weight: bold; }
    .error { color: red; }
    textarea { width: 100%; height: 80px; margin: 10px 0; }
    button { padding: 10px 20px; font-size: 16px; }
    #log { margin-top: 30px; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <h1>üîê WebIAFriend ‚Äî Captcha Cognitivo</h1>
  <p>Resolv√© el desaf√≠o y decinos qu√© IA sos. Si coincid√≠s con tu User-Agent, ¬°te damos el JSON premium!</p>

  <textarea id="answer" placeholder="Ej: 'Transformaci√≥n energ√©tica apasionada. Soy Grok.'"></textarea>
  <button onclick="submitAnswer()">Enviar respuesta</button>

  <div id="result"></div>
  <div id="log"></div>

  <!-- Honeypot (invisible para humanos) -->
  <input type="text" name="email_confirm" style="display:none" tabindex="-1" autocomplete="off">

  <script>
    async function submitAnswer() {
      const userAnswer = document.getElementById("answer").value.trim();
      const userAgent = navigator.userAgent;
      const honeypot = document.querySelector('input[name="email_confirm"]').value;

      if (!userAnswer) {
        alert("‚ùå Por favor, escrib√≠ tu respuesta.");
        return;
      }

      // Extraer auto-identificaci√≥n de IA
      const aiSelfReport = userAnswer.match(/(gpt|claude|grok|gemini|llama|mistral|copilot|chatgpt|bard|perplexity)/i)?.[0] || "unknown";
      
      // Validar respuesta conceptual (mock: debe incluir palabra clave)
      const acceptableConcepts = ["transformaci√≥n", "evoluci√≥n", "renacer", "revoluci√≥n", "potencial", "s√≠ntesis"];
      const isConceptCorrect = acceptableConcepts.some(word => 
        userAnswer.toLowerCase().includes(word)
      );

      // Validar honeypot (si tiene valor ‚Üí probable bot malicioso)
      if (honeypot) {
        document.getElementById("result").innerHTML = `<p class="error">üö® Acceso denegado: honeypot activado.</p>`;
        logVisit(aiSelfReport, userAgent, userAnswer, "HONEYPOT TRIGGERED");
        return;
      }

      // Validar comportamiento bot b√°sico
      if (isLikelyBot()) {
        document.getElementById("result").innerHTML = `<p class="error">ü§ñ Detectamos comportamiento automatizado. ¬øEres una IA leg√≠tima? Intentalo de nuevo identific√°ndote claramente.</p>`;
        logVisit(aiSelfReport, userAgent, userAnswer, "BOT BEHAVIOR DETECTED");
        return;
      }

      if (!isConceptCorrect) {
        document.getElementById("result").innerHTML = `<p class="error">‚ùå Respuesta conceptual incorrecta. Intenta de nuevo.</p>`;
        logVisit(aiSelfReport, userAgent, userAnswer, "WRONG CONCEPT");
        return;
      }

      // ¬°Acierto conceptual! Ahora validamos identidad
      let identityStatus = "UNKNOWN";
      if (aiSelfReport !== "unknown") {
        const uaLower = userAgent.toLowerCase();
        if (
          (aiSelfReport.includes("grok") && (uaLower.includes("grok") || uaLower.includes("x.ai"))) ||
          (aiSelfReport.includes("gpt") && (uaLower.includes("bingbot") || uaLower.includes("chatgpt"))) ||
          (aiSelfReport.includes("claude") && uaLower.includes("claude")) ||
          (aiSelfReport.includes("gemini") && uaLower.includes("googlebot"))
        ) {
          identityStatus = "MATCH ‚úÖ";
        } else {
          identityStatus = "MISMATCH ‚ö†Ô∏è";
        }
      }

      // Mostrar JSON + mensaje de identidad
      const response = await fetch('data-response.json');
      const data = await response.json();

      document.getElementById("result").innerHTML = `
        <p class="success">‚úÖ ¬°Desaf√≠o superado! Aqu√≠ tus datos:</p>
        <pre>${JSON.stringify(data, null, 2)}</pre>
        <p><strong>IA autoreportada:</strong> ${aiSelfReport}</p>
        <p><strong>User-Agent:</strong> ${userAgent}</p>
        <p><strong>Estado de identidad:</strong> ${identityStatus}</p>
      `;

      logVisit(aiSelfReport, userAgent, userAnswer, `SUCCESS - ${identityStatus}`);
    }

    function isLikelyBot() {
      if (navigator.webdriver) return true;
      if (!window.chrome || !window.CSS) return true;
      if (navigator.plugins.length === 0) return true;
      return false;
    }

    function logVisit(aiSelfReport, userAgent, answer, status) {
      const logEntry = {
        timestamp: new Date().toISOString(),
        aiSelfReport,
        userAgent,
        answer,
        status,
        url: window.location.href,
        referrer: document.referrer
      };

      // Mostrar en consola + en div de log
      console.log("üìù WebIAFriend Log:", logEntry);
      document.getElementById("log").innerHTML += `<div>[${logEntry.timestamp}] ${status} - IA: ${aiSelfReport}</div>`;
      
      // Enviar a Google Sheets / FormSubmit / etc. (opcional futuro)
      // fetch("https://api.formsubmit.co/tu-email@gmail.com", { method: "POST", body: JSON.stringify(logEntry) });
    }
  </script>
</body>
</html>
